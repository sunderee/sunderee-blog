<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sunderee Blog - Building RSS Feed Aggregator With Flutter</title>



<link rel="canonical" href="https://sunderee.github.io/sunderee-blog/posts/building-rss-feed-aggregator-with-flutter.html">
<meta name="twitter:title" content="Sunderee Blog - Building RSS Feed Aggregator With Flutter">
<meta name="description" content="RSS should make a comeback, why did I develop my app and what can you learn from it">
<meta name="author" content="Peter Aleksander Bizjak">
<meta name="keywords" content="Flutter">
<meta name="url" content="https://sunderee.github.io/sunderee-blog/posts/building-rss-feed-aggregator-with-flutter.html">
<meta property="og:title" content="Sunderee Blog - Building RSS Feed Aggregator With Flutter">
<meta property="og:url" content="https://sunderee.github.io/sunderee-blog/posts/building-rss-feed-aggregator-with-flutter.html">
<meta property="og:article:published_time" content="2023-06-09T15:26:00+00:00">
<meta property="og:type" content="article">


<link rel="sitemap" href="https://sunderee.github.io/sunderee-blog/sitemap.xml" type="application/xml" title="Sitemap">
<link rel="alternate" href="https://sunderee.github.io/sunderee-blog/feed.xml" type="application/rss+xml" title="HydePHP RSS Feed">
<meta name="twitter:creator" content="@peteralexbizjak">
<meta name="generator" content="HydePHP v1.1.0">
<meta property="og:site_name" content="Sunderee Blog">




<style>[x-cloak] {display: none!important}</style>


    <link rel="stylesheet" href="../media/app.css?v=ca99205ed438f1c291d827396d5adafb">





    
    <meta id="meta-color-scheme" name="color-scheme" content="light">
    <script>if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) { document.documentElement.classList.add('dark'); document.getElementById('meta-color-scheme').setAttribute('content', 'dark');} else { document.documentElement.classList.remove('dark') } </script>
</head>
<body id="app" class="flex flex-col min-h-screen overflow-x-hidden dark:bg-gray-900 dark:text-white" x-data="{ navigationOpen: false }" x-on:keydown.escape="navigationOpen = false;">
    <a href="#content" id="skip-to-content" class="sr-only focus:not-sr-only bg-black border-4 border-yellow-400 focus:absolute focus:mt-2 focus:mx-auto focus:p-2 focus:w-64 h-auto left-0 overflow-auto right-0 rounded-md text-center text-lg text-white top-auto z-50 ">Skip to content</a>    <nav aria-label="Main navigation" id="main-navigation" class="flex flex-wrap items-center justify-between p-4 shadow-lg sm:shadow-xl md:shadow-none dark:bg-gray-800">
    <div class="flex flex-grow items-center flex-shrink-0 text-gray-700 dark:text-gray-200">
        <a href="../index.html" class="font-bold px-4" aria-label="Home page">
    Sunderee Blog
</a>
        <div class="ml-auto">
            <button @click="toggleTheme" class="theme-toggle-button flex items-center px-2 py-1 hover:text-gray-700 dark:text-gray-200" title="Toggle theme">
        <span class="sr-only">Toggle dark theme</span>
        <svg width="1.25rem" height="1.25rem" class="w-5 h-5 hidden dark:block" fill="#FFFFFF" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
        <svg width="1.25rem" height="1.25rem" class="w-5 h-5 block dark:hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
    </button>
        </div>
    </div>

    <div class="block md:hidden">
        <button id="navigation-toggle-button" class="flex items-center px-3 py-1 hover:text-gray-700 dark:text-gray-200"
                aria-label="Toggle navigation menu" @click="navigationOpen = ! navigationOpen">
            <svg x-show="! navigationOpen" title="Open Navigation Menu" class="dark:fill-gray-200"
                 style="display: block;"
                 id="open-main-navigation-menu-icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24"
                 width="24"><title>Open Menu</title>
                <path d="M0 0h24v24H0z" fill="none"/>
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
            </svg>
            <svg x-show="navigationOpen" title="Close Navigation Menu" class="dark:fill-gray-200" style="display: none;"
                 id="close-main-navigation-menu-icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24"
                 width="24"><title>Close Menu</title>
                <path d="M0 0h24v24H0z" fill="none"></path>
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
            </svg>
        </button>
    </div>

    <div id="main-navigation-links" class="w-full x-uncloak-md md:flex flex-grow md:flex-grow-0 md:items-center md:w-auto px-6 -mx-4 border-t mt-3 pt-3 md:border-none md:mt-0 md:py-0 border-gray-200 dark:border-gray-700"
         :class="navigationOpen ? '' : 'hidden'" x-cloak>
        <ul aria-label="Navigation links" class="md:flex-grow md:flex justify-end">
                            <li class="md:mx-2">
                                            <a href="../index.html"  class="block my-2 md:my-0 md:inline-block py-1 text-gray-700 hover:text-gray-900 dark:text-gray-100">Home</a>                                    </li>
                            <li class="md:mx-2">
                                            <a href="../about.html"  class="block my-2 md:my-0 md:inline-block py-1 text-gray-700 hover:text-gray-900 dark:text-gray-100">About</a>                                    </li>
                    </ul>
    </div>
</nav>
    <section>
        
    <main id="content" class="mx-auto max-w-7xl py-16 px-8">
        <article aria-label="Article" id="building-rss-feed-aggregator-with-flutter" itemscope
         itemtype="https://schema.org/Article"
    class="post-article mx-auto prose dark:prose-invert torchlight-enabled">
    <meta itemprop="identifier" content="building-rss-feed-aggregator-with-flutter">
            <meta itemprop="url" content="https://sunderee.github.io/sunderee-blog/posts/building-rss-feed-aggregator-with-flutter.html">
    
    <header aria-label="Header section" role="doc-pageheader">
        <h1 itemprop="headline" class="mb-4">Building RSS Feed Aggregator With Flutter</h1>
        <div id="byline" aria-label="About the post" role="doc-introduction">
            Posted <time itemprop="dateCreated datePublished" datetime="2023-06-09T15:26:00+00:00" title="Friday Jun 9th, 2023, at 3:26pm">Jun 9th, 2023</time>            by author
<address itemprop="author" itemscope itemtype="https://schema.org/Person" aria-label="The post author" style="display: inline;">
                <span itemprop="name" aria-label="The author's name" title=@Peter+Aleksander+Bizjak>Peter Aleksander Bizjak</span>
            </address>            in the category "Flutter"        </div>
    </header>
        <div aria-label="Article body" itemprop="articleBody">
        <p>In an era of digital information overload, finding a simple, reliable, and unintrusive tool to aggregate the news that matters to you most can be a daunting challenge. Many of us have grown weary of the mainstream platforms that curate our newsfeeds, often inaccurately predicting our interests, and necessitating a constant tug-of-war with algorithms. Additionally, these platforms require account creation, leading to privacy concerns and a bloated experience. I found myself in this very predicament, yearning for a straightforward, user-friendly tool that would allow me to handpick my news sources without any unnecessary features or unwelcome interference.</p>
<p>Moreover, as a privacy-conscious individual, the question of who was behind the apps I used and what they might do with my data was constantly on my mind. And to be honest, the user interfaces of many existing RSS feed aggregator apps left a lot to be desired. So, I decided to take matters into my own hands. Why not build a simple, elegant, and trustworthy RSS Feed Aggregator with Flutter?</p>
<p><a href="https://github.com/sunderee/yrss">This app</a> was created with the objective of simplicity and user control at its core. Upon opening it, you are greeted with a minimalist interface where you can input the URL of a desired RSS feed, which is then added to your list. From there, you can browse through the aggregated news, open individual items, and either read the description or load the full article via an in-app WebView.</p>
<p>Designed with an offline-first approach, you can always access your news, even without an active internet connection, ensuring you are never out of touch with your favorite sources. The first version is built using Google's Material 3 theme, adhering strictly to the principles of Material Design, without any custom widgets. Initially, the app is available for iOS users, but plans are already in motion to bring it to Android, as well as to introduce new features such as bookmarking, feed list rearranging, folder creation, and routine bug fixes.</p>
<p>Let's dive into it then!</p>
<h2>About RSS</h2>
<p>RSS, short for Really Simple Syndication, is a web feed format that allows users and applications to access updates to online content in a standardized, computer-readable format. These feeds can be read using software called an &quot;RSS reader&quot;, &quot;feed reader&quot;, or &quot;aggregator&quot;. RSS feeds are an easy and automated way for users to receive new content from multiple sources, in a unified and easy-to-access format, without having to manually check each website.</p>
<p>RSS feeds use a standardized XML (eXtensible Markup Language) file format. But why XML over other data formats, like JSON (JavaScript Object Notation)? The answer lies in the historical context and the fundamental differences between the two data formats. RSS was conceived in the late 1990s and early 2000s, a time when XML was the de facto standard for data interchange, well before JSON gained its popularity.</p>
<p>XML was designed to store and transport data, with a focus on what data is. It uses a markup language to define custom tags that facilitate the description, transmission, and interpretation of data. In contrast, JSON, which came into prominence later, is a data-interchange format that focuses on how data is structured, offering a more compact and easy-to-parse format.</p>
<p>When RSS was being developed, XML was the natural choice due to its wide adoption and its ability to describe complex data structures in a way that was both human- and machine-readable. Despite JSON's later rise in popularity due to its simplicity and compactness, the shift in the standard format for RSS feeds would have required a significant overhaul of existing systems and thus has not occurred.</p>
<p>There are alternatives to RSS for content syndication, each with its unique strengths. Atom, for example, is a popular alternative that also uses XML and offers more advanced features like content summarization and categorization. However, it's more complex to implement than RSS.</p>
<p>Another alternative is JSON Feed, a newer format that uses JSON instead of XML. It offers the advantages of JSON, such as a more compact format and easier parsing, but it's not as widely adopted as RSS or Atom.</p>
<h2>About the App</h2>
<p>The decision to use Flutter as the development platform was a straightforward one, given my extensive experience as a professional Flutter developer over the past three years. During this time, I have come to appreciate the numerous benefits the platform offers, particularly in terms of codebase size and developer experience.</p>
<ol>
<li>
<p>The size of the codebase for the RSS Feed Aggregator is a testament to Flutter's efficiency. As it stands, the entire codebase comprises fewer than 3,000 lines of code. This conciseness leads to easier maintainability, quicker debugging, and overall a more manageable project.</p>
</li>
<li>
<p>The developer experience that Flutter offers is second to none. The robustness and simplicity of the platform allowed me to build the business logic for the RSS Feed Aggregator in just an afternoon. Within a single weekend, I had a working MVP. This rapid development cycle is a testament to the ease of use and efficiency that Flutter provides.</p>
</li>
</ol>
<p>When it came to choosing the initial platform, I opted for iOS first because my device is an iPhone. This personal access facilitated a more intimate testing and debugging process, allowing me to understand the user experience firsthand, and in turn, refine the app's functionality and design.</p>
<p>As for the programming language, I decided to utilize all the latest features of Dart 3. This decision is rooted in my firm belief that the only way to build good software is to embrace progress and live on the slightly riskier side of things. Staying up-to-date with the latest developments allows us to harness the power and efficiencies they offer, leading to a more robust and efficient application.</p>
<p>Looking ahead, I plan to migrate from the stable branch to the master branch by the time this article is published. This transition is in line with my approach to embracing progress and will enable me to stay on the cutting edge, taking advantage of the latest improvements and updates to Flutter, thus enhancing the app's features and overall performance.</p>
<h2>Let's Get Technical</h2>
<p>Letâ€™s check out some code, boys!</p>
<h3>Architecture</h3>
<p>Choosing the right tools and architecture plays a crucial role in the success of an application, and our RSS Feed Aggregator app is no exception. This article will delve into the architectural decisions and technical considerations that shaped the app's development.</p>
<p>At the heart of the app's state management, we find BLoC - Business Logic Component. BLoC offers a clear and systematic way to manage data flow within the app, promoting a clean separation between the business logic and the presentation layer. This separation facilitates a cleaner and more maintainable codebase.</p>
<pre><code data-theme="material-theme-palenight" data-lang="dart" class='torchlight' style='background-color: #292D3E; --theme-selection-background: #00000080;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 1</span><span style="color: #89DDFF;">typedef</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">FeedState</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> ({</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 2</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">bool</span><span style="color: #A6ACCD;"> hasData</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 3</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">List</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">FeedObjectSchema</span><span style="color: #89DDFF;">&gt;?</span><span style="color: #A6ACCD;"> data</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 4</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Object</span><span style="color: #89DDFF;">?</span><span style="color: #A6ACCD;"> exception</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 5</span><span style="color: #A6ACCD;">})</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 6</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 7</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">class</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">FeedCubit</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">extends</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Cubit</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">FeedState</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">with</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">BlocLoggy</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 8</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">FeedCubit</span><span style="color: #A6ACCD;">(</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 9</span><span style="color: #A6ACCD;">    super</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">initialState</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">10</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">required</span><span style="color: #A6ACCD;"> this</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">service</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">11</span><span style="color: #A6ACCD;">  }) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">12</span><span style="color: #A6ACCD;">    service</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">sourceStream</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">forEach</span><span style="color: #A6ACCD;">((</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> resource) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">13</span><span style="color: #A6ACCD;">      loggy</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">info</span><span style="color: #A6ACCD;">(resource</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">toString</span><span style="color: #A6ACCD;">())</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">14</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">15</span><span style="color: #A6ACCD;">      (</span><span style="color: #89DDFF;">switch</span><span style="color: #A6ACCD;"> (resource</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">status) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">16</span><span style="color: #A6ACCD;">        </span><span style="color: #FFCB6B;">ResourceStatus</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">empty </span><span style="color: #89DDFF;">||</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">ResourceStatus</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">loading</span><span style="color: #A6ACCD;"> =&gt; </span><span style="color: #82AAFF;">emit</span><span style="color: #A6ACCD;">((</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">17</span><span style="color: #A6ACCD;">            hasData</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">false,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">18</span><span style="color: #A6ACCD;">            data</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">null,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">19</span><span style="color: #A6ACCD;">            exception</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">null,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">20</span><span style="color: #A6ACCD;">          ))</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">21</span><span style="color: #A6ACCD;">        </span><span style="color: #FFCB6B;">ResourceStatus</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">success</span><span style="color: #A6ACCD;"> =&gt; </span><span style="color: #82AAFF;">emit</span><span style="color: #A6ACCD;">((</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">22</span><span style="color: #A6ACCD;">            hasData</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">true,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">23</span><span style="color: #A6ACCD;">            data</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> resource</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">data</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">24</span><span style="color: #A6ACCD;">            exception</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">null,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">25</span><span style="color: #A6ACCD;">          ))</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">26</span><span style="color: #A6ACCD;">        </span><span style="color: #FFCB6B;">ResourceStatus</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">failed</span><span style="color: #A6ACCD;"> =&gt; </span><span style="color: #82AAFF;">emit</span><span style="color: #A6ACCD;">((</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">27</span><span style="color: #A6ACCD;">            hasData</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">false,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">28</span><span style="color: #A6ACCD;">            data</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">null,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">29</span><span style="color: #A6ACCD;">            exception</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> resource</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">exception</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">30</span><span style="color: #A6ACCD;">          ))</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">31</span><span style="color: #A6ACCD;">      })</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">32</span><span style="color: #A6ACCD;">    })</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">33</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">34</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">35</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">IRssService</span><span style="color: #A6ACCD;"> service</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">36</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">37</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> _addSourceController </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">StreamController</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">AddSourceResult</span><span style="color: #89DDFF;">&gt;.</span><span style="color: #82AAFF;">broadcast</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">38</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Stream</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">AddSourceResult</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">get</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">addSourceStream</span><span style="color: #A6ACCD;"> =&gt; _addSourceController</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">stream</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">39</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">40</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">@override</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">41</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Future</span><span style="color: #89DDFF;">&lt;</span><span style="color: #C792EA;">void</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">close</span><span style="color: #A6ACCD;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">42</span><span style="color: #A6ACCD;">    _addSourceController</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">close</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">43</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">return</span><span style="color: #A6ACCD;"> super</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">close</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">44</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">45</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">46</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">void</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">loadData</span><span style="color: #A6ACCD;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">47</span><span style="color: #A6ACCD;">    loggy</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">info</span><span style="color: #A6ACCD;">(</span><span style="color: #C3E88D;">&#39;Loading RSS feed data...&#39;</span><span style="color: #A6ACCD;">)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">48</span><span style="color: #A6ACCD;">    service</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">readSources</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">49</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">50</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">51</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Future</span><span style="color: #89DDFF;">&lt;</span><span style="color: #C792EA;">void</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">addFeedURL</span><span style="color: #A6ACCD;">(</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">String</span><span style="color: #A6ACCD;"> url) </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">52</span><span style="color: #A6ACCD;">    loggy</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">info</span><span style="color: #A6ACCD;">(</span><span style="color: #C3E88D;">&#39;Attempting to add source $</span><span style="color: #A6ACCD;">url</span><span style="color: #C3E88D;"> and reload feeds...&#39;</span><span style="color: #A6ACCD;">)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">53</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">54</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> addSourceResult </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> service</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">addSource</span><span style="color: #A6ACCD;">(url)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">55</span><span style="color: #A6ACCD;">    loggy</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">info</span><span style="color: #A6ACCD;">(</span><span style="color: #C3E88D;">&#39;...add source result: $</span><span style="color: #A6ACCD;">addSourceResult</span><span style="color: #C3E88D;">&#39;</span><span style="color: #A6ACCD;">)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">56</span><span style="color: #A6ACCD;">    _addSourceController</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">add</span><span style="color: #A6ACCD;">(addSourceResult)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">57</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">58</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">if</span><span style="color: #A6ACCD;"> (addSourceResult </span><span style="color: #89DDFF;">==</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">AddSourceResult</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">success) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">59</span><span style="color: #A6ACCD;">      loggy</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">info</span><span style="color: #A6ACCD;">(</span><span style="color: #C3E88D;">&#39;...reloading feeds&#39;</span><span style="color: #A6ACCD;">)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">60</span><span style="color: #A6ACCD;">      </span><span style="color: #82AAFF;">loadData</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">61</span><span style="color: #A6ACCD;">    }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">62</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">63</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">64</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Future</span><span style="color: #89DDFF;">&lt;</span><span style="color: #C792EA;">void</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">removeFeedURL</span><span style="color: #A6ACCD;">(</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">String</span><span style="color: #A6ACCD;"> url) </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">65</span><span style="color: #A6ACCD;">    loggy</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">info</span><span style="color: #A6ACCD;">(</span><span style="color: #C3E88D;">&#39;Remove feed by URL: $</span><span style="color: #A6ACCD;">url</span><span style="color: #C3E88D;">...&#39;</span><span style="color: #A6ACCD;">)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">66</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> service</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">removeSource</span><span style="color: #A6ACCD;">(url)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">67</span><span style="color: #A6ACCD;">    </span><span style="color: #82AAFF;">loadData</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">68</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">69</span><span style="color: #A6ACCD;">}</span></div></code></pre>
<p>You might be wondering why I didn't use a dependency injection library for the project. The answer is simplicity. Given the app's straightforward nature, introducing an additional layer of complexity for dependency management would be unnecessary and could lead to complications. By keeping things simple, we maintain a lightweight, manageable codebase.</p>
<p>The application makes use of a custom implementation of the Network-Bound Resource (NBR) algorithm. NBR is a strategic pattern that helps decide whether to fetch data from the network or use locally stored data. By checking the database for up-to-date data before making network requests, NBR ensures efficient resource use and a seamless user experience.</p>
<p>To manage data storage, the app employs a combination of shared preferences and the Isar database. Shared preferences, a basic key-value store, hold the &quot;sources&quot; - the list of URLs to RSS feeds. In contrast, Isar, a high-performance, cross-platform database, enables the app's offline-first functionality. It stores the fetched RSS feed items, so users can access their news even without an internet connection.</p>
<p>While the app currently operates only in English, it's been set up for potential translations using the <code>intl</code> package. This preparation allows for easy translation into other languages in the future, possibly even by the user community itself.</p>
<p>The app's design philosophy embraces the bare minimum, cutting out unnecessary libraries. This approach minimizes the complexity introduced with each library and keeps the app lightweight and easy to maintain. With that being said, despite BLoC's benefits, I'm exploring even lighter solutions. These built-in Flutter solutions offer simple yet powerful state management capabilities and could prove to be a more efficient alternative for our needs.</p>
<p>The principle of &quot;program with interfaces, not implementations&quot; guides the app's architecture. By setting up a solid foundation from the beginning, we're future-proofing our app, preparing it for potential growth and new features. This approach also enhances testability and maintainability.</p>
<p>Lastly, I've opted for the strictest possible type of checks. While it might seem counterintuitive, this approach is a productivity booster. By catching potential bugs and errors early on, we save debugging time and promote good coding practices, leading to a more robust and reliable application.</p>
<h3>NBR</h3>
<p>The entire implementation revolves around the <code>NetworkBoundResource</code> abstract class and the <code>Resource</code> class. This implementation is also available as a <a href="https://pub.dev/packages/nbr">package on <code>pub.dev</code></a>.</p>
<h4><code>Resource</code> Class</h4>
<pre><code data-theme="material-theme-palenight" data-lang="dart" class='torchlight' style='background-color: #292D3E; --theme-selection-background: #00000080;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 1</span><span style="color: #676E95;">/// Enum representing different states in which a resource can be in.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 2</span><span style="color: #89DDFF;">enum</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">ResourceStatus</span><span style="color: #A6ACCD;"> { empty</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> loading</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> success</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> failed }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 3</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 4</span><span style="color: #676E95;">/// Immutable class representing a resource that can be in one of four states:</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 5</span><span style="color: #676E95;">/// </span><span style="color: #A6ACCD;">`empty`</span><span style="color: #676E95;">, </span><span style="color: #A6ACCD;">`loading`</span><span style="color: #676E95;">, </span><span style="color: #A6ACCD;">`success`</span><span style="color: #676E95;">, or </span><span style="color: #A6ACCD;">`failed`</span><span style="color: #676E95;">. It is designed to help manage</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 6</span><span style="color: #676E95;">/// and represent the state of a resource in a clean and consistent way.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 7</span><span style="color: #C792EA;">@immutable</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 8</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">class</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">T</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">extends</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Equatable</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 9</span><span style="color: #A6ACCD;">  </span><span style="color: #676E95;">/// The status of the resource.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">10</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">ResourceStatus</span><span style="color: #A6ACCD;"> status</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">11</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">12</span><span style="color: #A6ACCD;">  </span><span style="color: #676E95;">/// The data associated with the resource, if it is in the success state.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">13</span><span style="color: #676E95;">  /// It will be </span><span style="color: #A6ACCD;">`null`</span><span style="color: #676E95;"> if the resource is in any state other than success.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">14</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">T</span><span style="color: #89DDFF;">?</span><span style="color: #A6ACCD;"> data</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">15</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">16</span><span style="color: #A6ACCD;">  </span><span style="color: #676E95;">/// The exception associated with the resource, if it is in the failed state.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">17</span><span style="color: #676E95;">  /// It will be </span><span style="color: #A6ACCD;">`null`</span><span style="color: #676E95;"> if the resource is in any state other than failed.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">18</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Object</span><span style="color: #89DDFF;">?</span><span style="color: #A6ACCD;"> exception</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">19</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">20</span><span style="color: #A6ACCD;">  </span><span style="color: #676E95;">// Private constructor used by named constructors.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">21</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">const</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">_({</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">22</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">required</span><span style="color: #A6ACCD;"> this</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">status</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">23</span><span style="color: #A6ACCD;">    this</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">data</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">24</span><span style="color: #A6ACCD;">    this</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">exception</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">25</span><span style="color: #A6ACCD;">  })</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">26</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">27</span><span style="color: #A6ACCD;">  </span><span style="color: #676E95;">/// Named constructor for creating an empty resource.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">28</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">const</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">empty</span><span style="color: #A6ACCD;">() </span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> this</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">_(status</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">ResourceStatus</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">empty)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">29</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">30</span><span style="color: #A6ACCD;">  </span><span style="color: #676E95;">/// Named constructor for creating a loading resource. Takes the nullable</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">31</span><span style="color: #676E95;">  /// </span><span style="color: #A6ACCD;">[data]</span><span style="color: #676E95;"> which may or may not be associated with the resource</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">32</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">const</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">loading</span><span style="color: #A6ACCD;">([</span><span style="color: #FFCB6B;">T</span><span style="color: #89DDFF;">?</span><span style="color: #A6ACCD;"> data])</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">33</span><span style="color: #A6ACCD;">      </span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> this</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">_(</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">34</span><span style="color: #A6ACCD;">          status</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">ResourceStatus</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">loading</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">35</span><span style="color: #A6ACCD;">          data</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> data</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">36</span><span style="color: #A6ACCD;">        )</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">37</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">38</span><span style="color: #A6ACCD;">  </span><span style="color: #676E95;">/// Named constructor for creating a success resource. Takes the </span><span style="color: #A6ACCD;">[data]</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">39</span><span style="color: #676E95;">  /// associated with the resource.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">40</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">const</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">success</span><span style="color: #A6ACCD;">(</span><span style="color: #FFCB6B;">T</span><span style="color: #A6ACCD;"> data)</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">41</span><span style="color: #A6ACCD;">      </span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> this</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">_(</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">42</span><span style="color: #A6ACCD;">          status</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">ResourceStatus</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">success</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">43</span><span style="color: #A6ACCD;">          data</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> data</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">44</span><span style="color: #A6ACCD;">        )</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">45</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">46</span><span style="color: #A6ACCD;">  </span><span style="color: #676E95;">/// Named constructor for creating a failed resource. Takes the </span><span style="color: #A6ACCD;">[exception]</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">47</span><span style="color: #676E95;">  /// associated with the resource.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">48</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">const</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">failed</span><span style="color: #A6ACCD;">(</span><span style="color: #FFCB6B;">Object</span><span style="color: #A6ACCD;"> exception)</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">49</span><span style="color: #A6ACCD;">      </span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> this</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">_(</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">50</span><span style="color: #A6ACCD;">          status</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">ResourceStatus</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">failed</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">51</span><span style="color: #A6ACCD;">          exception</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> exception</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">52</span><span style="color: #A6ACCD;">        )</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">53</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">54</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">@override</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">55</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">List</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Object</span><span style="color: #89DDFF;">?&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">get</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">props</span><span style="color: #A6ACCD;"> =&gt; [status</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> data</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> exception]</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">56</span><span style="color: #A6ACCD;">}</span></div></code></pre>
<p>The <code>Resource</code> class is an immutable class representing a resource that can be in one of four states: <code>empty</code>, <code>loading</code>, <code>success</code>, or <code>failed</code>. This class is designed to help manage and represent the state of a resource in a clean and consistent way.</p>
<ul>
<li>
<code>status</code> indicates the current state of the resource.</li>
<li>
<code>data</code> holds the data associated with the resource if the resource is in the success state. Otherwise, it's <code>null</code>.</li>
<li>
<code>exception</code> captures any exception that occurred during the fetch operation if the resource is in the failed state. Otherwise, it's <code>null</code>.</li>
</ul>
<p>There are four named constructors corresponding to the four states a resource can be in.</p>
<h4><code>NetworkBoundResource</code> Class</h4>
<pre><code data-theme="material-theme-palenight" data-lang="dart" class='torchlight' style='background-color: #292D3E; --theme-selection-background: #00000080;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 1</span><span style="color: #676E95;">/// Abstract class representing a resource that is bound to a network request.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 2</span><span style="color: #676E95;">/// It uses a </span><span style="color: #A6ACCD;">[StreamController]</span><span style="color: #676E95;"> to emit a stream of </span><span style="color: #A6ACCD;">[Resource]</span><span style="color: #676E95;"> objects,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 3</span><span style="color: #676E95;">/// representing the current state of the resource (</span><span style="color: #A6ACCD;">`loading`</span><span style="color: #676E95;">, </span><span style="color: #A6ACCD;">`success`</span><span style="color: #676E95;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 4</span><span style="color: #676E95;">/// </span><span style="color: #A6ACCD;">`failed`</span><span style="color: #676E95;">, or </span><span style="color: #A6ACCD;">`empty`</span><span style="color: #676E95;">).</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 5</span><span style="color: #89DDFF;">abstract</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">class</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">NetworkBoundResource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 6</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">StreamController</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;&gt;?</span><span style="color: #A6ACCD;"> _controller</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 7</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Stream</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;&gt;?</span><span style="color: #A6ACCD;"> _stream</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 8</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 9</span><span style="color: #A6ACCD;">  </span><span style="color: #676E95;">/// Getter for the stream of Resource objects.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">10</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Stream</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">get</span><span style="color: #A6ACCD;"> stream {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">11</span><span style="color: #A6ACCD;">    </span><span style="color: #82AAFF;">_ensureControllerCreated</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">12</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">return</span><span style="color: #A6ACCD;"> _stream</span><span style="color: #89DDFF;">!;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">13</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">14</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">15</span><span style="color: #A6ACCD;">  </span><span style="color: #676E95;">/// Method to fetch the resource from the network and emit </span><span style="color: #A6ACCD;">[Resource]</span><span style="color: #676E95;"> objects</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">16</span><span style="color: #676E95;">  /// representing the current state of the resource.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">17</span><span style="color: #676E95;">  ///</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">18</span><span style="color: #676E95;">  /// This method takes several callbacks as arguments, which are used to fetch</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">19</span><span style="color: #676E95;">  /// the resource from the API, load it from the database, store it to the</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">20</span><span style="color: #676E95;">  /// database, determine if it should be fetched from the API, and map it from</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">21</span><span style="color: #676E95;">  /// a DTO to an entity.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">22</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Future</span><span style="color: #89DDFF;">&lt;</span><span style="color: #C792EA;">void</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">fetch</span><span style="color: #A6ACCD;">&lt;</span><span style="color: #FFCB6B;">DTO</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;">({</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">23</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">required</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">FetchFromApiCallback</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">DTO</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> fetchFromAPI</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">24</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">required</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">LoadFromDBCallback</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> loadFromDB</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">25</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">required</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">StoreToDBCallback</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> storeToDB</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">26</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">required</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">ShouldFetchCallback</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> shouldFetch</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">27</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">required</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">MapDTOToEntity</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">DTO</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> mapDTOToEntity</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">28</span><span style="color: #A6ACCD;">  }) </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">29</span><span style="color: #A6ACCD;">    _controller</span><span style="color: #89DDFF;">?.</span><span style="color: #82AAFF;">add</span><span style="color: #A6ACCD;">(</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;.</span><span style="color: #82AAFF;">loading</span><span style="color: #A6ACCD;">())</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">30</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> data </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">loadFromDB</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">31</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">32</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">if</span><span style="color: #A6ACCD;"> (</span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">shouldFetch</span><span style="color: #A6ACCD;">(data)) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">33</span><span style="color: #A6ACCD;">      _controller</span><span style="color: #89DDFF;">?.</span><span style="color: #82AAFF;">add</span><span style="color: #A6ACCD;">(</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;.</span><span style="color: #82AAFF;">loading</span><span style="color: #A6ACCD;">(data))</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">34</span><span style="color: #A6ACCD;">      </span><span style="color: #89DDFF;">try</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">35</span><span style="color: #A6ACCD;">        </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> dto </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">fetchFromAPI</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">36</span><span style="color: #A6ACCD;">        </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> entity </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">mapDTOToEntity</span><span style="color: #A6ACCD;">(dto)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">37</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">38</span><span style="color: #A6ACCD;">        </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">storeToDB</span><span style="color: #A6ACCD;">(entity)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">39</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">40</span><span style="color: #A6ACCD;">        _controller</span><span style="color: #89DDFF;">?.</span><span style="color: #82AAFF;">add</span><span style="color: #A6ACCD;">(</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;.</span><span style="color: #82AAFF;">success</span><span style="color: #A6ACCD;">(entity))</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">41</span><span style="color: #A6ACCD;">      } </span><span style="color: #89DDFF;">catch</span><span style="color: #A6ACCD;"> (exception) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">42</span><span style="color: #A6ACCD;">        _controller</span><span style="color: #89DDFF;">?.</span><span style="color: #82AAFF;">add</span><span style="color: #A6ACCD;">(</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;.</span><span style="color: #82AAFF;">failed</span><span style="color: #A6ACCD;">(exception))</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">43</span><span style="color: #A6ACCD;">      }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">44</span><span style="color: #A6ACCD;">    } </span><span style="color: #89DDFF;">else</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">45</span><span style="color: #A6ACCD;">      </span><span style="color: #89DDFF;">if</span><span style="color: #A6ACCD;"> (data </span><span style="color: #89DDFF;">!=</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">null</span><span style="color: #A6ACCD;">) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">46</span><span style="color: #A6ACCD;">        _controller</span><span style="color: #89DDFF;">?.</span><span style="color: #82AAFF;">add</span><span style="color: #A6ACCD;">(</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;.</span><span style="color: #82AAFF;">success</span><span style="color: #A6ACCD;">(data))</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">47</span><span style="color: #A6ACCD;">      } </span><span style="color: #89DDFF;">else</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">48</span><span style="color: #A6ACCD;">        _controller</span><span style="color: #89DDFF;">?.</span><span style="color: #82AAFF;">add</span><span style="color: #A6ACCD;">(</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;.</span><span style="color: #82AAFF;">empty</span><span style="color: #A6ACCD;">())</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">49</span><span style="color: #A6ACCD;">      }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">50</span><span style="color: #A6ACCD;">    }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">51</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">52</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">53</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">void</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">_ensureControllerCreated</span><span style="color: #A6ACCD;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">54</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">if</span><span style="color: #A6ACCD;"> (_controller </span><span style="color: #89DDFF;">==</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">null</span><span style="color: #A6ACCD;">) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">55</span><span style="color: #A6ACCD;">      _controller </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">StreamController</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Entity</span><span style="color: #89DDFF;">&gt;&gt;.</span><span style="color: #82AAFF;">broadcast</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">56</span><span style="color: #A6ACCD;">      _stream </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> _controller</span><span style="color: #89DDFF;">?.</span><span style="color: #A6ACCD;">stream</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">asBroadcastStream</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">57</span><span style="color: #A6ACCD;">    }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">58</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">59</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">60</span><span style="color: #A6ACCD;">  </span><span style="color: #676E95;">/// Method to dispose of the </span><span style="color: #A6ACCD;">[NetworkBoundResource]</span><span style="color: #676E95;"> by closing the</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">61</span><span style="color: #676E95;">  /// </span><span style="color: #A6ACCD;">[StreamController]</span><span style="color: #676E95;">.</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">62</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">void</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">dispose</span><span style="color: #A6ACCD;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">63</span><span style="color: #A6ACCD;">    _controller</span><span style="color: #89DDFF;">?.</span><span style="color: #82AAFF;">close</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">64</span><span style="color: #A6ACCD;">    _controller </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">null;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">65</span><span style="color: #A6ACCD;">    _stream </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">null;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">66</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">67</span><span style="color: #A6ACCD;">}</span></div></code></pre>
<p>The <code>NetworkBoundResource</code> class is the heart of the NBR implementation. It's an abstract class that represents a resource bound to a network request. The <code>fetch</code> method is where the actual data fetching logic resides.</p>
<ul>
<li>
<code>_controller</code> and <code>_stream</code> are used to create a stream of <code>Resource</code> objects representing the current state of the resource (<code>loading</code>, <code>success</code>, <code>failed</code>, or <code>empty</code>).</li>
<li>
<code>fetch</code> method fetches the resource from the network and emits <code>Resource</code> objects representing the current state of the resource. It takes several callbacks as arguments, which are used to fetch the resource from the API, load it from the database, store it to the database, determine if it should be fetched from the API, and map it from a DTO to an entity.</li>
</ul>
<p>The <code>fetch</code> method first loads data from the database. Then, based on the <code>shouldFetch</code> callback, it decides whether to fetch data from the API or not. If it decides to fetch, it adds a <code>loading</code> resource to the stream, fetches the data, stores it in the database, and then adds a <code>success</code> resource to the stream. If an error occurs during this process, it adds a <code>failed</code> resource to the stream.</p>
<p>If it decides not to fetch, it adds a <code>success</code> resource to the stream if there's data, or an <code>empty</code> resource if there's no data.</p>
<p>The <code>_ensureControllerCreated</code> method ensures that the <code>StreamController</code> is created before it's used. The <code>dispose</code> method cleans up by closing the <code>StreamController</code>.</p>
<p>This code leverages Dart 3's new class modifier feature (which is something I <a href="https://sunderee.github.io/sunderee-blog/posts/deep-dive-into-dart-3-class-modifiers.html">already wrote about</a>).</p>
<h3>RSS Service</h3>
<pre><code data-theme="material-theme-palenight" data-lang="dart" class='torchlight' style='background-color: #292D3E; --theme-selection-background: #00000080;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">  1</span><span style="color: #89DDFF;">enum</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">AddSourceResult</span><span style="color: #A6ACCD;"> { success</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> failed }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">  2</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">  3</span><span style="color: #89DDFF;">abstract</span><span style="color: #A6ACCD;"> interface </span><span style="color: #89DDFF;">class</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">IRssService</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">  4</span><span style="color: #A6ACCD;">  </span><span style="color: #89DDFF;">factory</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">IRssService</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">instance</span><span style="color: #A6ACCD;">(</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">  5</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">IPreferencesService</span><span style="color: #A6ACCD;"> preferencesService</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">  6</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Isar</span><span style="color: #A6ACCD;"> isarInstance</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">  7</span><span style="color: #A6ACCD;">  ) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">  8</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">return</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">_RssService</span><span style="color: #A6ACCD;">(preferencesService</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> isarInstance)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">  9</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 10</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 11</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Stream</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">List</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">FeedObjectSchema</span><span style="color: #89DDFF;">&gt;&gt;&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">get</span><span style="color: #A6ACCD;"> sourceStream</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 12</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 13</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">void</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">readSources</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 14</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Future</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">AddSourceResult</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">addSource</span><span style="color: #A6ACCD;">(</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">String</span><span style="color: #A6ACCD;"> url)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 15</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Future</span><span style="color: #89DDFF;">&lt;</span><span style="color: #C792EA;">void</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">removeSource</span><span style="color: #A6ACCD;">(</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">String</span><span style="color: #A6ACCD;"> url)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 16</span><span style="color: #A6ACCD;">}</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 17</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 18</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">class</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">_RssService</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">extends</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">NetworkBoundResource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">List</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">FeedObjectSchema</span><span style="color: #89DDFF;">&gt;&gt;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 19</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">implements</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">IRssService</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 20</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">_RssService</span><span style="color: #A6ACCD;">(this</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">preferencesService</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> this</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">isarInstance)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 21</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 22</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">static</span><span style="color: #A6ACCD;"> </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">HttpClient</span><span style="color: #A6ACCD;"> _client </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">HttpClient</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 23</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">static</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Future</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">String</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">_makeHTTPRequest</span><span style="color: #A6ACCD;">(</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">String</span><span style="color: #A6ACCD;"> url) </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 24</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> request </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> _client</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">getUrl</span><span style="color: #A6ACCD;">(</span><span style="color: #FFCB6B;">Uri</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">parse</span><span style="color: #A6ACCD;">(url))</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 25</span><span style="color: #A6ACCD;">    </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> response </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> request</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">close</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 26</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">return</span><span style="color: #A6ACCD;"> response</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">transform</span><span style="color: #A6ACCD;">&lt;</span><span style="color: #FFCB6B;">String</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;">(utf8</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">decoder)</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">join</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 27</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 28</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 29</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">IPreferencesService</span><span style="color: #A6ACCD;"> preferencesService</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 30</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Isar</span><span style="color: #A6ACCD;"> isarInstance</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 31</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 32</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">@override</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 33</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Stream</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">Resource</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">List</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">FeedObjectSchema</span><span style="color: #89DDFF;">&gt;&gt;&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">get</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">sourceStream</span><span style="color: #A6ACCD;"> =&gt; stream</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 34</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 35</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">@override</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 36</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">void</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">readSources</span><span style="color: #A6ACCD;">() </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 37</span><span style="color: #A6ACCD;">    </span><span style="color: #82AAFF;">fetch</span><span style="color: #A6ACCD;">&lt;</span><span style="color: #FFCB6B;">List</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">FeedObject</span><span style="color: #89DDFF;">&gt;&gt;</span><span style="color: #A6ACCD;">(</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 38</span><span style="color: #A6ACCD;">      fetchFromAPI</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> () </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #A6ACCD;"> preferencesService</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">sources</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">let</span><span style="color: #A6ACCD;">(</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 39</span><span style="color: #A6ACCD;">            (</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> it) </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Future</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">wait</span><span style="color: #A6ACCD;">(</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 40</span><span style="color: #A6ACCD;">              it</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">map</span><span style="color: #A6ACCD;">((</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> item) </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">_parseFeedObject</span><span style="color: #A6ACCD;">(item))</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 41</span><span style="color: #A6ACCD;">            )</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 42</span><span style="color: #A6ACCD;">          )</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 43</span><span style="color: #A6ACCD;">      loadFromDB</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> () </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">=&gt;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 44</span><span style="color: #A6ACCD;">          isarInstance</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">collection</span><span style="color: #A6ACCD;">&lt;</span><span style="color: #FFCB6B;">FeedObjectSchema</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">where</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">findAll</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 45</span><span style="color: #A6ACCD;">      storeToDB</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> (</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">List</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">FeedObjectSchema</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> schemas) </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 46</span><span style="color: #A6ACCD;">        </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> collection </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> isarInstance</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">collection</span><span style="color: #A6ACCD;">&lt;</span><span style="color: #FFCB6B;">FeedObjectSchema</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 47</span><span style="color: #A6ACCD;">        isarInstance</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">writeTxn</span><span style="color: #A6ACCD;">(() </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 48</span><span style="color: #A6ACCD;">          </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> collection</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">clear</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 49</span><span style="color: #A6ACCD;">          </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> collection</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">putAll</span><span style="color: #A6ACCD;">(schemas)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 50</span><span style="color: #A6ACCD;">        })</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 51</span><span style="color: #A6ACCD;">      }</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 52</span><span style="color: #A6ACCD;">      shouldFetch</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> (</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">List</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">FeedObjectSchema</span><span style="color: #89DDFF;">&gt;?</span><span style="color: #A6ACCD;"> schemas) </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 53</span><span style="color: #A6ACCD;">        </span><span style="color: #89DDFF;">if</span><span style="color: #A6ACCD;"> (schemas </span><span style="color: #89DDFF;">==</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">null</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">||</span><span style="color: #A6ACCD;"> schemas</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">isEmpty </span><span style="color: #89DDFF;">==</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">true</span><span style="color: #A6ACCD;">) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 54</span><span style="color: #A6ACCD;">          </span><span style="color: #89DDFF;">return</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">true;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 55</span><span style="color: #A6ACCD;">        }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 56</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 57</span><span style="color: #A6ACCD;">        </span><span style="color: #89DDFF;">return</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">switch</span><span style="color: #A6ACCD;"> (</span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> (</span><span style="color: #FFCB6B;">Connectivity</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">checkConnectivity</span><span style="color: #A6ACCD;">())) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 58</span><span style="color: #A6ACCD;">          </span><span style="color: #FFCB6B;">ConnectivityResult</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">mobile </span><span style="color: #89DDFF;">||</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 59</span><span style="color: #A6ACCD;">          </span><span style="color: #FFCB6B;">ConnectivityResult</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">wifi </span><span style="color: #89DDFF;">||</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 60</span><span style="color: #A6ACCD;">          </span><span style="color: #FFCB6B;">ConnectivityResult</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">vpn</span><span style="color: #A6ACCD;"> =&gt;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 61</span><span style="color: #A6ACCD;">            </span><span style="color: #89DDFF;">true,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 62</span><span style="color: #A6ACCD;">          _ </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">false</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 63</span><span style="color: #A6ACCD;">        }</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 64</span><span style="color: #A6ACCD;">      }</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 65</span><span style="color: #A6ACCD;">      mapDTOToEntity</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> (</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">List</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">FeedObject</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> dtoList) </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #A6ACCD;"> dtoList</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 66</span><span style="color: #A6ACCD;">          </span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">map</span><span style="color: #A6ACCD;">((</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> item) </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">FeedObjectSchema</span><span style="color: #A6ACCD;">()</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 67</span><span style="color: #A6ACCD;">            </span><span style="color: #89DDFF;">..</span><span style="color: #A6ACCD;">title </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">title</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 68</span><span style="color: #A6ACCD;">            </span><span style="color: #89DDFF;">..</span><span style="color: #A6ACCD;">url </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">url</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 69</span><span style="color: #A6ACCD;">            </span><span style="color: #89DDFF;">..</span><span style="color: #A6ACCD;">sourceURL </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">sourceURL</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 70</span><span style="color: #A6ACCD;">            </span><span style="color: #89DDFF;">..</span><span style="color: #A6ACCD;">description </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">description</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 71</span><span style="color: #A6ACCD;">            </span><span style="color: #89DDFF;">..</span><span style="color: #A6ACCD;">items </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">items</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 72</span><span style="color: #A6ACCD;">                </span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">map</span><span style="color: #A6ACCD;">((</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> innerItem) </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">FeedObjectItemSchema</span><span style="color: #A6ACCD;">()</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 73</span><span style="color: #A6ACCD;">                  </span><span style="color: #89DDFF;">..</span><span style="color: #A6ACCD;">title </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> innerItem</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">title</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 74</span><span style="color: #A6ACCD;">                  </span><span style="color: #89DDFF;">..</span><span style="color: #A6ACCD;">description </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> innerItem</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">description</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 75</span><span style="color: #A6ACCD;">                  </span><span style="color: #89DDFF;">..</span><span style="color: #A6ACCD;">published </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> innerItem</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">published</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 76</span><span style="color: #A6ACCD;">                  </span><span style="color: #89DDFF;">..</span><span style="color: #A6ACCD;">link </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> innerItem</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">link)</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 77</span><span style="color: #A6ACCD;">                </span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">toList</span><span style="color: #A6ACCD;">())</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 78</span><span style="color: #A6ACCD;">          </span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">toList</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 79</span><span style="color: #A6ACCD;">    )</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 80</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 81</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 82</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">@override</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 83</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Future</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">AddSourceResult</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">addSource</span><span style="color: #A6ACCD;">(</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">String</span><span style="color: #A6ACCD;"> url) </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 84</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">try</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 85</span><span style="color: #A6ACCD;">      </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> content </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">compute</span><span style="color: #A6ACCD;">&lt;</span><span style="color: #FFCB6B;">String</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">String</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;">(_makeHTTPRequest</span><span style="color: #89DDFF;">,</span><span style="color: #A6ACCD;"> url)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 86</span><span style="color: #A6ACCD;">      </span><span style="color: #FFCB6B;">UniversalFeed</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">parseFromString</span><span style="color: #A6ACCD;">(content)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 87</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 88</span><span style="color: #A6ACCD;">      </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> preferencesService</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">addRssSource</span><span style="color: #A6ACCD;">(url)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 89</span><span style="color: #A6ACCD;">      </span><span style="color: #89DDFF;">return</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">AddSourceResult</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">success</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 90</span><span style="color: #A6ACCD;">    } </span><span style="color: #89DDFF;">catch</span><span style="color: #A6ACCD;"> (e) {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 91</span><span style="color: #A6ACCD;">      </span><span style="color: #89DDFF;">return</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">AddSourceResult</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">failed</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 92</span><span style="color: #A6ACCD;">    }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 93</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 94</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 95</span><span style="color: #A6ACCD;">  </span><span style="color: #C792EA;">@override</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 96</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Future</span><span style="color: #89DDFF;">&lt;</span><span style="color: #C792EA;">void</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">removeSource</span><span style="color: #A6ACCD;">(</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">String</span><span style="color: #A6ACCD;"> url) </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 97</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> preferencesService</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">removeRssSource</span><span style="color: #A6ACCD;">(url)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 98</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 99</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">100</span><span style="color: #A6ACCD;">  </span><span style="color: #FFCB6B;">Future</span><span style="color: #89DDFF;">&lt;</span><span style="color: #FFCB6B;">FeedObject</span><span style="color: #89DDFF;">&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">_parseFeedObject</span><span style="color: #A6ACCD;">(</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">String</span><span style="color: #A6ACCD;"> url) </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">101</span><span style="color: #A6ACCD;">    </span><span style="color: #89DDFF;">return</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">Isolate</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">run</span><span style="color: #A6ACCD;">(() </span><span style="color: #89DDFF;">async</span><span style="color: #A6ACCD;"> {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">102</span><span style="color: #A6ACCD;">      </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> rawRssFeed </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #89DDFF;">await</span><span style="color: #A6ACCD;"> </span><span style="color: #82AAFF;">_makeHTTPRequest</span><span style="color: #A6ACCD;">(url)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">103</span><span style="color: #A6ACCD;">      </span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> rssFeed </span><span style="color: #89DDFF;">=</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">UniversalFeed</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">parseFromString</span><span style="color: #A6ACCD;">(rawRssFeed)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">104</span><span style="color: #A6ACCD;">      </span><span style="color: #89DDFF;">return</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">FeedObject</span><span style="color: #A6ACCD;">(</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">105</span><span style="color: #A6ACCD;">        title</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> rssFeed</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">title </span><span style="color: #89DDFF;">??</span><span style="color: #A6ACCD;"> url</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">106</span><span style="color: #A6ACCD;">        url</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> rssFeed</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">links</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">firstOrNull</span><span style="color: #89DDFF;">?.</span><span style="color: #A6ACCD;">href </span><span style="color: #89DDFF;">??</span><span style="color: #A6ACCD;"> url</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">107</span><span style="color: #A6ACCD;">        sourceURL</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> url</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">108</span><span style="color: #A6ACCD;">        description</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> rssFeed</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">description</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">109</span><span style="color: #A6ACCD;">        items</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> rssFeed</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">items</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">110</span><span style="color: #A6ACCD;">            </span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">map</span><span style="color: #A6ACCD;">((</span><span style="color: #C792EA;">final</span><span style="color: #A6ACCD;"> item) </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #A6ACCD;"> </span><span style="color: #FFCB6B;">FeedObjectItem</span><span style="color: #A6ACCD;">(</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">111</span><span style="color: #A6ACCD;">                  title</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">title </span><span style="color: #89DDFF;">??</span><span style="color: #A6ACCD;"> </span><span style="color: #C3E88D;">&#39;&#39;</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">112</span><span style="color: #A6ACCD;">                  description</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">description</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">113</span><span style="color: #A6ACCD;">                  published</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">published</span><span style="color: #89DDFF;">?.</span><span style="color: #A6ACCD;">value </span><span style="color: #89DDFF;">??</span><span style="color: #A6ACCD;"> item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">updated</span><span style="color: #89DDFF;">?.</span><span style="color: #A6ACCD;">value</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">114</span><span style="color: #A6ACCD;">                  link</span><span style="color: #89DDFF;">:</span><span style="color: #A6ACCD;"> item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">link</span><span style="color: #89DDFF;">?.</span><span style="color: #A6ACCD;">href </span><span style="color: #89DDFF;">??</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">115</span><span style="color: #A6ACCD;">                      item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">links</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">firstOrNull</span><span style="color: #89DDFF;">?.</span><span style="color: #A6ACCD;">href </span><span style="color: #89DDFF;">??</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">116</span><span style="color: #A6ACCD;">                      item</span><span style="color: #89DDFF;">.</span><span style="color: #A6ACCD;">guid </span><span style="color: #89DDFF;">??</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">117</span><span style="color: #A6ACCD;">                      </span><span style="color: #C3E88D;">&#39;&#39;</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">118</span><span style="color: #A6ACCD;">                ))</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">119</span><span style="color: #A6ACCD;">            </span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">toList</span><span style="color: #A6ACCD;">()</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">120</span><span style="color: #A6ACCD;">      )</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">121</span><span style="color: #A6ACCD;">    })</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">122</span><span style="color: #A6ACCD;">  }</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">123</span><span style="color: #A6ACCD;">}</span></div></code></pre>
<p>This code represents a crucial part of my RSS reader application. It demonstrates fetching, storing, and displaying of RSS feed data. The code uses the Network-Bound Resource (NBR) pattern, leveraging the classes discussed previously, to handle these operations efficiently.</p>
<p>The <code>IRssService</code> interface defines the contract for the RSS service. It has a factory constructor that returns an instance of <code>_RssService</code>, which is a private implementation of <code>IRssService</code>. This interface exposes four methods:</p>
<ul>
<li>
<code>readSources</code>: Reads the RSS feed sources.</li>
<li>
<code>addSource</code>: Adds a new RSS feed source.</li>
<li>
<code>removeSource</code>: Removes an existing RSS feed source.</li>
<li>
<code>sourceStream</code>: A getter that returns a stream of <code>Resource</code> objects representing the current state of the feed sources.</li>
</ul>
<p>The <code>_RssService</code> class is a concrete implementation of the <code>IRssService</code> interface. It extends the <code>NetworkBoundResource</code> abstract class and provides the implementation of the methods defined in <code>IRssService</code>. The class uses a <code>HttpClient</code> to make HTTP requests, an <code>IPreferencesService</code> to interact with the user preferences, and an <code>Isar</code> instance to interact with the database.</p>
<p>The <code>readSources</code> method uses the <code>fetch</code> method from <code>NetworkBoundResource</code> to fetch the RSS feed sources, deciding whether to fetch from the network or use cached data based on certain conditions. It maps the data transfer object (DTO) to the entity, stores it to the database, and emits a stream of <code>Resource</code> objects representing the current state of the feed sources.</p>
<p>The <code>addSource</code> method adds a new RSS feed source. It first makes an HTTP request to fetch the RSS feed data, parses it, adds the source to the user preferences, and returns a success status. If an error occurs during this process, it returns a failed status.</p>
<p>The <code>removeSource</code> method removes an existing RSS feed source from the user preferences.</p>
<p>The <code>_parseFeedObject</code> method is a helper method that makes an HTTP request to fetch the RSS feed data, parses it, and returns a <code>FeedObject</code> representing the RSS feed.</p>
<p>This code demonstrates an efficient way to manage data fetching operations that should be coordinated between a local database and a remote API. It's a well-structured and robust solution to handle such operations in an RSS reader application, making the code easier to understand, test, and maintain.</p>
<h2>Summary</h2>
<p>We've delved into the technical aspects of a simple yet sophisticated RSS reader app built with Flutter. The app is powered by Dart 3, with a focus on a robust architecture, efficient state management, and an offline-first approach, reflecting best practices in mobile app development.</p>
<p>The application uses the BLoC (Business Logic Component) pattern for state management, which separates the business logic from the UI, making the codebase easier to maintain and test. However, given the simplicity of the app, it avoids dependency injection libraries, favoring simplicity and direct instantiation.</p>
<p>One of the key features of the app is its custom implementation of the Network-Bound Resource (NBR) pattern, which is a powerful strategy to balance local and network data sources. This approach is particularly useful for applications that need to operate offline or under poor network conditions, as it allows the app to function seamlessly whether data is fetched from an API or loaded from a local database.</p>
<p>For data persistence, the application uses a combination of shared preferences and the Isar database. Shared preferences are used to store &quot;sources&quot; (a list of URLs to RSS feeds), while Isar powers the app's offline-first functionality.</p>
<p>The application is designed with internationalization in mind, using the <code>intl</code> library. While the app is currently only available in English, it is ready for translations, either manually or through the community.</p>
<p>Given the simplicity of the app, it might be tempting to overlook architectural best practices. However, the importance of a solid architectural foundation cannot be overstated. Following the principle &quot;program with interfaces, not implementations,&quot; even in a simple app, provides flexibility for future enhancements and makes the code easier to maintain and test.</p>
<p>In addition, we examined and explained several sections of Dart code that power the core functionality of this app. The first section of code defines an abstract <code>NetworkBoundResource</code> class, which establishes the structure for handling data that can be in four states (<code>empty</code>, <code>loading</code>, <code>success</code>, or <code>failed</code>). This class, along with the <code>Resource</code> class, forms the backbone of the app's NBR implementation.</p>
<p>The second section of code introduced the <code>IRssService</code> interface and its concrete implementation <code>_RssService</code>. This part of the code manages the fetching, storing, and manipulation of RSS feeds. It exemplifies how the app interacts with both network (HTTP requests) and local (preferences and Isar database) data sources, effectively bringing the NBR concept to life.</p>
<p>Overall, this conversation has highlighted the importance of good architecture and best practices in the development of a simple yet powerful RSS reader app. The app's design and implementation underscore how Flutter and Dart can be used to create efficient, maintainable, and robust mobile applications, even when keeping the tech stack minimalistic and straightforward.</p>
<br><p>
    <i>
        Syntax highlighting by <a href="https://torchlight.dev/" rel="noopener nofollow">Torchlight.dev</a>
    </i>
</p>

    </div>
    <span class="sr-only">End of article</span>
</article>    </main>

    </section>

    <footer aria-label="Page footer" class="flex py-4 px-6 w-full text-center mt-auto bg-slate-100 dark:bg-gray-800">
        <div class="prose dark:prose-invert text-center mx-auto">
            <p>Built on <a href="https://github.com/hydephp/hyde">HydePHP</a> | Based on â¤ï¸, â˜•ï¸, ðŸ§  + ðŸ¤– and ðŸ˜‚</p>

        </div>
        <a href="#app" aria-label="Go to top of page" class="float-right">
            <button title="Scroll to top">
                <svg width="1.5rem" height="1.5rem" role="presentation" class="fill-current text-gray-500 h-6 w-6"
                     xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                    <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
                </svg>
            </button>
        </a>
    </footer>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.10.3/dist/cdn.min.js" integrity="sha256-gOkV4d9/FmMNEkjOzVlyM2eNAWSUXisT+1RbMTTIgXI=" crossorigin="anonymous"></script>

<script>
    function toggleTheme() {
        if (localStorage.getItem('color-theme') === 'dark' || !('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.remove("dark");
            localStorage.setItem('color-theme', 'light');
            document.getElementById('meta-color-scheme').setAttribute('content', 'light');
        } else {
            document.documentElement.classList.add("dark");
            localStorage.setItem('color-theme', 'dark');
            document.getElementById('meta-color-scheme').setAttribute('content', 'dark');
        }
    }
</script>


</body>
</html>
